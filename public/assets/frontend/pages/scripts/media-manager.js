var uploadzone;$.fn.mediaupload=function(e){var a=$.extend({backdrop:"static",width:"760",fullwidth:!0,url:null,upload:"upload","multi-select":!0,insert:"uploadzone-insert","delete":"uploadzone-delete",complete:function(){console.log("Please provide complete callback")}},e);$.fn.mediaupload.selected=[];var d,l=this,t="uploadzone",n=function(e){"success"==e.status&&($.fn.mediaupload.multiselect===!1&&($("#"+t+" .selected").removeClass("selected"),$.fn.mediaupload.selected=[e]),$.fn.mediaupload.selected.push(e),$(e.previewElement).addClass("selected"),e.xhr?(data=JSON.parse(e.xhr.response),console.log(data),$(e.previewElement).data("id",data.id)):$(e.previewElement).data("id",e.id),$(e.previewElement).append('<div class="check icon icon-ok"></div>'),$(e.previewElement).on("click",function(){$.fn.mediaupload.multiselect===!0?($(this).toggleClass("selected"),$(this).hasClass("selected")?$.fn.mediaupload.selected.push(e):$.fn.mediaupload.selected.splice($.fn.mediaupload.selected.indexOf(e),1)):($.fn.mediaupload.selected=[],selectedElement=$(this).hasClass("selected"),$("#"+t+" .selected").removeClass("selected"),selectedElement||($(this).addClass("selected"),$.fn.mediaupload.selected.push(e)))}))},s=function(e){$(this).unbind(e);var d=[];selectedElements=$.fn.mediaupload.previewContainer.find(".selected"),selectedElements.each(function(e,l){image={},image.name=$(l).find(".dz-filename span").text(),image.src="/"+a.upload+"/"+image.name,image.id=$(l).data("id"),d.push(image),$(this).removeClass("selected")}),console.log(d),d.length&&($.fn.mediaupload.modal.modal("hide"),a.complete.call(null,d))},i=function(){if($.fn.mediaupload.selected.length>0){var e=[];$.each($.fn.mediaupload.selected,function(a,d){uploadzone.removeFile(d),d.xhr?(image=JSON.parse(d.xhr.response),e.push(image.id)):e.push(d.id)}),console.log(e),$.ajax({url:a.url,type:"delete",data:{images:e}}),$.fn.mediaupload.selected=[]}};return 0==$("#"+t).size()&&($.fn.mediaupload.modal=$("<div/>",{id:t,"class":"modal fade modal-scroll","data-backdrop":a.backdrop}),$.fn.mediaupload.previewContainer=$('<form action="'+a.url+'" class="uploadzone"><input name="_token" type="hidden" value="'+a.token+'"/></form>'),$.fn.mediaupload.mediaInfo=$("<div/>",{"class":"media-info"}).append('<div class="attachment-details save-ready" data-id="" tabindex="0"><h3>Thông tin hình ảnh</h3><div class="attachment-info"><div class="thumbnail thumbnail-image"><img src="" draggable="false"></div><div class="details"><div class="filename"></div><div class="uploaded"></div><div class="compat-meta"></div></div></div><label class="setting" data-setting="url"><span class="name">URL</span><input value="" readonly="" type="text"></label><label class="setting" data-setting="title"><span class="name">Title</span><input value="" type="text"></label><label class="setting" data-setting="caption"><span class="name">Caption</span><textarea></textarea></label><label class="setting" data-setting="alt"><span class="name">Alt Text</span><input value="" type="text"></label><label class="setting" data-setting="description"><span class="name">Description</span><textarea></textarea></label></div>'),d=$("<div/>",{"class":"right-sidebar"}).append($.fn.mediaupload.mediaInfo),modalbody=$('<div class="modal-body"></div>').append($.fn.mediaupload.previewContainer).append(d),$.fn.mediaupload.modal.append('<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button><h4>Media Manager</h4></div>'),$.fn.mediaupload.modal.append(modalbody),$.fn.mediaupload.modal.append('<div class="modal-footer"><button type="button" data-dismiss="modal" class="btn btn-xs">Đóng</button><button type="button" class="btn btn-primary btn-xs btn-uploadzone clickable">Upload</button><button type="button" class="btn btn-primary btn-xs '+a["delete"]+'">Xóa</button><button type="button" class="btn btn-primary btn-xs '+a.insert+'">Chèn</button></div>'),a.fullwidth?$.fn.mediaupload.modal.addClass("container"):$.fn.mediaupload.modal.attr("data-width",a.width),$("body").append($.fn.mediaupload.modal),uploadzone=new Dropzone("#"+t+" .uploadzone",{parallelUploads:1,uploadMultiple:!1,multiselect:a["multi-select"],clickable:"#"+t+" .btn-uploadzone,.uploadzone",complete:n}),$.fn.mediaupload.modal.on("show.bs.modal",function(){$.fn.mediaupload.modal.data("z-index",parseInt($(".modal-backdrop:last").css("z-index")))}).on("shown.bs.modal",function(){$.fn.mediaupload.modal.parent().css("z-index",$.fn.mediaupload.modal.data("z-index"))}),$.ajax({url:a.url,type:"get",dataType:"json",success:function(e){e&&$.each(e,function(e,a){var d={id:a.id,name:a.name,status:"success",accepted:!0,width:400,height:400,upload:{bytesSend:100,progress:100,total:100}};uploadzone.emit("addedfile",d),uploadzone.emit("thumbnail",d,a.thumbnail),uploadzone.emit("success",d),uploadzone.emit("complete",d)})}})),l.click(function(){$("#"+t+" .selected").removeClass("selected"),$.fn.mediaupload.selected=[],$.fn.mediaupload.multiselect=a["multi-select"],$.fn.mediaupload.modal.find("."+a.insert).bind("click",s),$.fn.mediaupload.modal.find("."+a["delete"]).bind("click",i),$.fn.mediaupload.modal.modal("show")}),this};